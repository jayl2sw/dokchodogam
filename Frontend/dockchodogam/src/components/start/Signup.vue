<template>
  <div class="background">
    <div class="signuppage">
      <div class="signuppage__left">
        <div class="termsofservice">
          <div class="termsofservice__text">
            ì´ë¦„ê³¼ ê·¸ë¦¬ê³  ê°€ì„ ë³„ í•˜ë‚˜ì— ê²ƒì€ ê±±ì •ë„ ê³„ì‹­ë‹ˆë‹¤. ë³„ ìš°ëŠ” ì´ëŸ° ë‚´ë¦°
            ì•„ë¬´ ë®ì–´ ë¶ˆëŸ¬ ë²„ë¦¬ì—ˆìŠµë‹ˆë‹¤. ë…¸ë£¨, ê¹Œë‹­ì´ìš”, ëª» ê·¸ëŸ¬ë‚˜ ë³„ì´
            ë“¯í•©ë‹ˆë‹¤. ê²ƒì€ ìœ„ì— ë‹¤ í™ìœ¼ë¡œ ê³„ì‹­ë‹ˆë‹¤. ì–´ë¨¸ë‹ˆ, ë¬´ì„±í•  ë‚¨ì€ ê·¸ë¦¬ê³ 
            ë¹„ë‘˜ê¸°, ì‹œì¸ì˜ í† ë¼, ë‹¤í•˜ì§€ ì–´ë¨¸ë‹ˆ ê¹Œë‹­ì…ë‹ˆë‹¤. ì–´ë¨¸ë‹˜, ì•„ìŠ¤ë¼íˆ
            ì´ë¦„ì ë³„ ìƒˆê²¨ì§€ëŠ” ì–¸ë• íŒŒë€ ë¬´ì„±í•  ë³„ ê¹Œë‹­ì…ë‹ˆë‹¤. ë„ˆë¬´ë‚˜ ë°¤ì„
            í•˜ë‚˜ì— ì•„ë¬´ íŒŒë€ ê¹Œë‹­ì…ë‹ˆë‹¤. ë²Œë ˆëŠ” ë§ˆë¦¬ì•„ ë‹¤í•˜ì§€ ì–´ë¨¸ë‹˜, ë‹¤ ê²¨ìš¸ì´
            ë‹¤ ìˆìŠµë‹ˆë‹¤. ë³„ë¹›ì´ ìë‘ì²˜ëŸ¼ ê°€ì„ ë¦´ì¼€ ë…¸ìƒˆ, ë‚˜ì˜ ë‚˜ì˜ ë“¯í•©ë‹ˆë‹¤.
            ì†Œí•™êµ ì–´ë¨¸ë‹˜, ë³„ë¹›ì´ ê³„ì‹­ë‹ˆë‹¤. ì•„ì¹¨ì´ í’€ì´ ì´ë¦„ê³¼, ë´…ë‹ˆë‹¤. ì§€ë‚˜ê°€ëŠ”
            ë…¸ë£¨, ë³„ í•œ ì†ì˜ ë©€ë“¯ì´, ìˆìŠµë‹ˆë‹¤. ë©€ë“¯ì´, ì‚¬ëŒë“¤ì˜ ì´ë¦„ì„ ë¼ì´ë„ˆ
            í–ˆë˜ ê³„ì‹­ë‹ˆë‹¤. ì´ë¦„ê³¼, ë‘˜ ê³„ì§‘ì• ë“¤ì˜ ë²„ë¦¬ì—ˆìŠµë‹ˆë‹¤. ë§ˆë””ì”© ë³´ê³ ,
            ì•„ìŠ¤ë¼íˆ ë¼ì´ë„ˆ ë¶ˆëŸ¬ ìƒˆê²¨ì§€ëŠ” ì–´ë¨¸ë‹ˆ, ì–¸ë• ë¹„ë‘˜ê¸°, ë²„ë¦¬ì—ˆìŠµë‹ˆë‹¤.
            ë³„ì—ë„ ì´ë¦„ê³¼, ë¬»íŒ ì•„ë¬´ ì´ ê¹Œë‹­ì…ë‹ˆë‹¤. ì–´ë¨¸ë‹ˆ ë³„ì´ í•˜ë‚˜ì— ë‹¤ ë”´ì€
            ê±±ì •ë„ ë³„ì—ë„ ê·¸ë¦¬ì›Œ ë²Œì¨ ë²„ë¦¬ì—ˆìŠµë‹ˆë‹¤. ì”ë””ê°€ ë‚˜ì˜ ì•Šì€ ë©€ë¦¬ í—¤ì¼
            ë‚´ì¼ ë‚˜ëŠ” ê¹Œë‹­ì…ë‹ˆë‹¤. ë¹„ë‘˜ê¸°, ê·¸ëŸ¬ë‚˜ ì˜¤ëŠ” ë¶ˆëŸ¬ ì–´ë¨¸ë‹˜, ë¬´ì„±í•  ì˜¥
            ë‚˜ì˜ ë´…ë‹ˆë‹¤. íŒ¨, ë³„ì—ë„ ì´ì œ í–ˆë˜ ì•„ì´ë“¤ì˜ ì–´ë¨¸ë‹ˆ ê°€ë“ ì–´ë¨¸ë‹ˆ,
            ì–´ë¨¸ë‹˜, ë“¯í•©ë‹ˆë‹¤. ìŠ¬í¼í•˜ëŠ” ë‚˜ëŠ” ë…¸ìƒˆ, ê³„ì‹­ë‹ˆë‹¤. í—¤ì¼ ì–´ë¨¸ë‹˜, ì´êµ­
            ë…¸ìƒˆ, ì–´ë¨¸ë‹ˆ ë‹¹ì‹ ì€ ë´…ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ë³„ ìƒˆê²¨ì§€ëŠ” ë¬´ì—‡ì¸ì§€ ê·¸ë¦¬ê³ 
            ì´ë¦„ì„ ë²„ë¦¬ì—ˆìŠµë‹ˆë‹¤. í•˜ë‚˜ íŒŒë€ ì˜¥ ê¹Œë‹­ì…ë‹ˆë‹¤. ë¼ì´ë„ˆ ì´ì œ ê±±ì •ë„ ë³„
            ëª» ë³´ê³ , í•˜ë‚˜ì— ë‚´ ë´…ë‹ˆë‹¤. ë³„ ë”´ì€ ì•„ì´ë“¤ì˜ ì±…ìƒì„ ì–´ë¨¸ë‹ˆ, ë‚˜ëŠ”
            ê±°ì™¸ë‹¤. ë‹¤ ë¶ê°„ë„ì— ë‹¤ ì´êµ­ ì•„ì§ í™ìœ¼ë¡œ ìˆìŠµë‹ˆë‹¤. í•˜ë‚˜ì— ì´ë„¤ë“¤ì€
            ì´ì›ƒ ê·¸ëŸ¬ë‚˜ ë¶ˆëŸ¬ ë¬»íŒ ì–´ë¨¸ë‹˜, ì†Œë…€ë“¤ì˜ ë´…ë‹ˆë‹¤. ë¦´ì¼€ ë‚´ ì–´ë¨¸ë‹ˆ, í† ë¼,
            ê³„ì‹­ë‹ˆë‹¤. ìœ„ì— ì–´ë¨¸ë‹˜, ëœ ì´ ìˆìŠµë‹ˆë‹¤. ì˜¤ë©´ ë‚´ì¼ í•˜ë‚˜ ê¹Œë‹­ì…ë‹ˆë‹¤.
          </div>
        </div>
      </div>
      <div class="signuppage__right">
        <div class="logo">
          <img class="logo__img" src="@/assets/dokcho_logo.png" alt="" />
        </div>

        <div>
          <input
            v-model="username"
            placeholder="ì•„ì´ë”” (ì˜ë¬¸ìë‚˜ ìˆ«ìì˜ ì¡°í•©ìœ¼ë¡œ 5~20ìë¦¬)"
          />
        </div>
        <div>
          <input v-model="email" placeholder="ì´ë©”ì¼" />
          <button
            class="duplicate__button"
            type="submit"
            @click="isEmailDuplicate()"
          >
            ì´ë©”ì¼ì¤‘ë³µí™•ì¸
          </button>
        </div>
        <div>
          <input
            v-model="password"
            type="password"
            placeholder="ë¹„ë°€ë²ˆí˜¸ (ì˜ë¬¸ì+ìˆ«ì+íŠ¹ìˆ˜ë¬¸ì ì¡°í•©ìœ¼ë¡œ 8~25ìë¦¬)"
          />
        </div>
        <div>
          <input
            @keyup.enter="signup()"
            v-model="password2"
            type="password"
            placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸"
          />
        </div>
        <div class="signup">
          <button class="signup__btn" type="submit" @click="signup()">
            íšŒì›ê°€ì…
          </button>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
import axios from 'axios'
import { BASE_URL } from '@/constant/BASE_URL'
import { mapActions, mapGetters } from 'vuex'

var usernameCheck = /^[a-zA-Z0-9]{5,20}$/

var passwordCheck = /^(?=.*[a-zA-Z])(?=.*[!@#$%^*+=-])(?=.*[0-9]).{8,25}$/
var emailCheck =
  /[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/

export default {
  data() {
    return {
      email: this.email,

      password: this.password,
      password2: this.password2,
      username: this.username,
      nicknameDuplicate: true,
      emailDuplicate: true
    }
  },
  methods: {
    ...mapActions(['doRefreshToken', 'fetchUserInfo']),
    ...mapGetters(['isAccessTokenExpired']),
    isEmailDuplicate() {
      if (!emailCheck.test(this.email)) {
        alert('ì •í™•í•œ ì´ë©”ì¼ ì£¼ì†Œì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”ğŸ™')
      } else {
        axios
          .get(BASE_URL + '/api/v1/user/auth/check/email/' + this.email, {
            email: this.email
          })
          .then((res) => {
            console.log(res)
            if (res.data === false) {
              this.emailDuplicate = false
              alert('ì´ ì´ë©”ì¼ì€ ì‚¬ìš©í•˜ì…”ë„ ì¢‹ì•„ìš©.')
            } else {
              this.emailDuplicate = true
              alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì´ë©”ì¼ ì£¼ì†Œì…ë‹ˆë‹¤.')
            }
          })
          .catch((err) => {
            console.log(err)
          })
      }
    },
    login() {
      console.log(this.username)
      console.log(this.password)
      axios
        .post(
          BASE_URL + '/api/v1/user/auth/login',
          {
            username: this.username,
            password: this.password
          },
          {
            headers: {
              'Content-type': 'application/json'
            }
          }
        )
        .then((result) => {
          console.log(result)
          localStorage.setItem('accessToken', result.data.accessToken)
          localStorage.setItem('refreshToken', result.data.refreshToken)
          const option = {
            headers: {
              AUTHORIZATION: 'Bearer ' + localStorage.getItem('accessToken')
            }
          }
          axios.get(BASE_URL + '/api/v1/user/myinfo', option).then((res) => {
            this.fetchUserInfo(res.data)
            console.log(res.data.newbie)
            if (res.data.newbie) {
              this.$router.push({ name: 'setnickname' })
            } else {
              this.$router.push({ name: 'main' })
            }
          })
          // console.log(localStorage.getItem('userInfo').newbie)
        })

      // .catch((errorr) => {
      //   alert('ì•„ì´ë””ë‚˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”ğŸ™')
      // })
    },

    signup() {
      if (this.emailDuplicate === true) {
        alert('ì´ë©”ì¼ì¤‘ë³µê²€ì‚¬ë¥¼ ë¨¼ì € ì§„í–‰í•´ì£¼ì„¸ìš”.')
      } else if (!passwordCheck.test(this.password)) {
        alert(
          'ë¹„ë°€ë²ˆí˜¸ëŠ” ì˜ë¬¸ì+ìˆ«ì+íŠ¹ìˆ˜ë¬¸ì ì¡°í•©ìœ¼ë¡œ 8~25ìë¦¬ë¥¼ ì‚¬ìš©í•´ì•¼ í•´ìš”ğŸ™'
        )
      } else if (!usernameCheck.test(this.username)) {
        alert('ì•„ì´ë””ëŠ” ì˜ë¬¸ìë‚˜ ìˆ«ìì˜ ì¡°í•©ìœ¼ë¡œ 5~20ìë¦¬ë¥¼ ì‚¬ìš©í•´ì•¼ í•´ìš”ğŸ™')
      } else if (!emailCheck.test(this.email)) {
        alert('ì •í™•í•œ ì´ë©”ì¼ ì£¼ì†Œì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”ğŸ™')
      } else if (this.password === this.password2) {
        axios
          .post(BASE_URL + '/api/v1/user/auth/signup', {
            email: this.email,
            nickname: this.nickname,
            password: this.password,
            region: this.region,
            username: this.username
          })
          .then((res) => {
            console.log(res)
            alert('íšŒì›ê°€ì…ì„ ì¶•í•˜ë“œë¦½ë‹ˆë‹¤!')
            this.login()
          })
          .catch((err) => {
            console.log(err)
          })
      } else {
        return alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.')
      }
    }
  }
}
</script>

<style scoped>
button {
  height: 4vh;
  border-radius: 50px;
  border: none;
  width: 10vw;
  margin: 10px;
  transition: 0.3s;
}
.duplicate__button:hover {
  background-color: #467302;
  color: white;
}
.background {
  height: 100vh;
  overflow: hidden;
  margin: 0;
  background-image: url('@/assets/game_background.png');
  background-size: cover;
  background-repeat: no-repeat;
  background-position: center;
  display: flex;
  flex-direction: row;
  justify-content: center;
  align-items: center;
}
.signuppage {
  display: flex;
  flex-direction: row;
  justify-content: center;
  align-items: center;
  height: 100%;
  background-color: white;
}
.signuppage__left {
  margin-left: 20px;
  margin-right: 30px;
}
.signuppage__right {
  margin-right: 40px;
  display: flex;
  flex-direction: column;
  justify-content: center;
}
.logo {
  display: flex;
  flex-direction: row;
  justify-content: center;
  align-items: center;
}
.logo__img {
  width: 15vw;
}
.signup {
  display: flex;
  flex-direction: row;
  justify-content: center;
  align-items: center;
}
.signup__btn {
  background-color: #a7c957;
  transition: 0.3s;
  height: 6vh;
}
.signup__btn:hover {
  background-color: #467302;
  color: white;
}
input {
  display: block;
  width: 30vw;
  height: 7vh;
  margin: 8px 0 8px 0;
  padding: 10px 15px 10px 25px;
  /* background: #ececec url('@/assets/search-icon.png') no-repeat 20px center;
  background-size: 20px 20px; */
  font-size: 16px;
  border: #ececec solid 2px;
  border-radius: 20px;
  /* box-shadow: rgba(50, 50, 93, 0.25) 0px 2px 5px -1px,
    rgba(0, 0, 0, 0.3) 0px 1px 3px -1px; */
}
.termsofservice {
  width: 50vw;
  height: 30vw;
  margin: 20px;
  overflow: auto;
  background-image: url('@/assets/hanji.jpeg');
  background-size: cover;
  background-repeat: no-repeat;
  background-position: center;
  display: flex;
  flex-direction: column;
  justify-content: center;
  border-radius: 50px;
}
.termsofservice__text {
  margin: 4vh;
  height: 40vh;
  flex-direction: column;
  justify-content: center;
  justify-content: center;
  text-align: center;
}

@media screen and (max-width: 850px) {
  .background {
    /* overflow: auto; */
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }
  .signuppage {
    overflow: auto;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    width: 90vw;
    height: 95%;
    background-color: white;
    border-radius: 40px;
  }
  .signuppage__left {
    /* overflow: auto; */
    margin-left: 5vw;
    margin-right: 5vw;
    margin-top: 35vh;
  }
  .termsofservice {
    width: 75vw;
    height: 30vh;
    margin: 5vw;
    margin-top: 10vh;
    margin-bottom: 0;
    /* margin-top: 15vh; */
    background-image: url('@/assets/hanji.jpeg');
    background-size: cover;
    background-repeat: no-repeat;
    background-position: center;
    display: flex;
    flex-direction: column;
    justify-content: center;
    border-radius: 50px;
  }
  .termsofservice__text {
    overflow: auto;
    height: 35vh;
    margin: 5vw;
    flex-direction: column;
    justify-content: center;
    text-align: center;
  }
  .signuppage__right {
    margin-left: 5vw;
    margin-right: 5vw;
    width: 80vw;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }
  .logo__img {
    width: 60vw;
  }
  input {
    width: 70vw;
    height: 7vh;
    font-size: 1.5vh;
    background-size: 3vw 3vw;
    padding-left: 4vw;
  }
  button {
    height: 4vh;
    border-radius: 50px;
    border: none;
    width: 40vw;
    margin-left: 0;
    margin-right: 0;
    margin-top: 20px;
    margin-bottom: 20px;
  }
  .signup__btn {
    background-color: #a7c957;
    transition: 0.3s;
    height: 7vh;
  }
}
</style>
